<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Configuration Form View -->
    <record id="view_telegram_config_form" model="ir.ui.view">
        <field name="name">telegram.config.form</field>
        <field name="model">telegram.config</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="test_connection" string="Test Connection" type="object" class="btn-primary"/>
                    <button name="action_sync_team_members" string="Sync Team Members" type="object" 
                            class="btn-success" invisible="not team_source_group_id"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="e.g., Nero Bot"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Bot Configuration">
                            <field name="bot_token" password="True"/>
                            <field name="bot_owner_telegram_id" placeholder="Your Telegram User ID"/>
                            <field name="active"/>
                        </group>
                        <group string="Statistics">
                            <field name="last_update_id" readonly="1"/>
                            <field name="total_groups"/>
                            <field name="total_messages"/>
                        </group>
                    </group>
                    <group string="Team Configuration">
                        <group>
                            <field name="team_source_group_id" options="{'no_create': True}"/>
                        </group>
                        <group>
                            <field name="monitoring_alerts_group_id" options="{'no_create': True}"/>
                        </group>
                    </group>
                    <group string="Security">
                        <field name="log_unauthorized_attempts"/>
                    </group>
                    <notebook>
                        <page string="Instructions">
                            <group>
                                <div class="alert alert-info" role="alert">
                                    <h4>üéñÔ∏è Setup Instructions:</h4>
                                    <ol>
                                        <li><strong>Bot Token:</strong> Enter your bot token from @BotFather</li>
                                        <li><strong>Bot Owner ID:</strong> Enter YOUR Telegram User ID (you can always add bot anywhere)</li>
                                        <li><strong>Test Connection:</strong> Click to verify bot is working</li>
                                        <li><strong>Team Source Group:</strong> Select your "Nerosoft Team" Telegram group</li>
                                        <li><strong>Monitoring Alerts Group:</strong> Select group that receives operational alerts</li>
                                        <li><strong>Sync Team Members:</strong> Click to import all current team members</li>
                                        <li><strong>Auto-Detection:</strong> Anyone who joins/leaves team source group is automatically registered/deactivated</li>
                                    </ol>
                                    <hr/>
                                    <h4>üîî Monitoring Alerts:</h4>
                                    <ul>
                                        <li>New group creation notifications</li>
                                        <li>Setup delay alerts (30 min)</li>
                                        <li>Setup completion confirmations</li>
                                        <li>Security breach attempts</li>
                                    </ul>
                                    <hr/>
                                    <h4>üîí Security:</h4>
                                    <ul>
                                        <li>Only YOU (bot owner) and active team members can add bot to groups</li>
                                        <li>Unauthorized users will see a warning and bot will leave automatically</li>
                                        <li>All unauthorized attempts are logged for security audit</li>
                                    </ul>
                                    <hr/>
                                    <p><strong>‚ö†Ô∏è Important:</strong> Make sure your bot is an admin in all groups and has privacy mode disabled via @BotFather.</p>
                                </div>
                            </group>
                        </page>
                        <page string="How to Find Your Telegram ID">
                            <group>
                                <div class="alert alert-warning" role="alert">
                                    <h4>üì± How to Get Your Telegram User ID:</h4>
                                    <p><strong>Method 1: Use a Bot</strong></p>
                                    <ol>
                                        <li>Open Telegram and search for <code>@userinfobot</code></li>
                                        <li>Start the bot and send any message</li>
                                        <li>Bot will reply with your User ID</li>
                                        <li>Copy that ID and paste it in "Bot Owner Telegram ID" field above</li>
                                    </ol>
                                    <p><strong>Method 2: Use GetIDs Bot</strong></p>
                                    <ol>
                                        <li>Search for <code>@getidsbot</code> in Telegram</li>
                                        <li>Start the bot</li>
                                        <li>It will show your ID immediately</li>
                                    </ol>
                                </div>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Configuration List View -->
    <record id="view_telegram_config_tree" model="ir.ui.view">
        <field name="name">telegram.config.tree</field>
        <field name="model">telegram.config</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="team_source_group_id"/>
                <field name="total_groups"/>
                <field name="total_messages"/>
                <field name="active"/>
            </list>
        </field>
    </record>

    <!-- Action -->
    <record id="action_telegram_config" model="ir.actions.act_window">
        <field name="name">Telegram Configuration</field>
        <field name="res_model">telegram.config</field>
        <field name="view_mode">list,form</field>
    </record>

    <!-- Menu -->
    <menuitem id="menu_telegram_root" name="Telegram Monitor" sequence="10"/>
    <menuitem id="menu_telegram_configuration" name="Configuration" parent="menu_telegram_root" action="action_telegram_config" sequence="10"/>
</odoo>